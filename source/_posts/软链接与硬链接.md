---
title: 软链接与硬链接
categories: Linux

---



### 1. 是什么
* **链接：**一种在共享文件和访问它的用户的若干目录项之间建立联系的一种方法。
* **【硬链接】（hard link）：**指通过索引节点来进行连接，就是一个文件(不是文件夹)的别名，无论有多少各别名，但它其实是一个文件。
可以这样理解：
>一面墙上有一个洞，洞里放着一个苹果。从墙的这一面看是这个苹果，从墙的另一面看还是同一个苹果
>也就是说同一块数据但有两个不同的名字，读写的时候本质上都是修改的同一块数据。

  **硬链接的删除：**
>硬链接在删除的时候只是删除了一个名字，只有一块数据的所有名字都删除了的时候，数据才会被删除。（删除的时候相当于把墙的这一面糊上，但苹果本身不动，只有两面都糊上了，你才会看不到）

* **【软链接】（又称符号链接，即 soft link 或 symbolic link）**：相当于我们 Windows 中的快捷方式，即如果你软链接一个目录，只是一个目录的快捷方式到指定位置，操作系统找这个快捷方式会直接找到真实目录下的文件。
可以这样理解：
>我声称我有一个苹果，但是当你找我要的时候，我对你说，到某个建筑物的仓库就可以拿到那个苹果了。可见我并不真正拥有一个苹果，我只是拥有“某个地方有一个苹果”这个信息。但对于外部的观察者来说，这跟我实际上拥有一个苹果并无差异。

  **软链接的删除：**
>假设我死了，不会影响到原始数据。假设原始数据没了，那我这个符号链接就变成了一张空头支票，也就是悬空的符号链接。

  **一个符号链接可以指向一个不存在的目标，而硬链接就表示肯定有文件存在。
硬链接可以指向文件，也可以指向目录。可以跨越任何文件系统。拷贝删除原始文件或者链接文件，不会造成相互影响。**

### 2. 怎么查看
  通过`ls -l`查看，`->`后面就是原始地址
  
```
$ ls -l
total 6964
lrwxrwxrwx 1 wangdanna wangdanna      48 10月 14 16:07 1.jpg -> /home/wangdanna/Downloads/picture/wallpaper1.jpg
-rw-rw-r-- 2 wangdanna wangdanna    3858 10月  9 02:13 7.jpg
-rw-rw-r-- 1 wangdanna wangdanna   14009 10月  9 01:51 love.jpg
-rw-rw-r-- 1 wangdanna wangdanna   66420 10月  9 16:51 persepolis_6-t2.jpg

```

如上图，前面带有`l`的就是软链接，不带的则是硬链接，`lrwxrwxrwx 1 wangdanna wangdanna      48 10月 14 16:07 1.jpg -> /home/wangdanna/Downloads/picture/wallpaper1.jpg` 在`->`后面的是真实路径
### 3. 优缺点
* 优点
**硬连接**的作用是允许一个文件拥有多个有效路径名，这样用户就可以建立硬连接到重要文件，以防止“误删”的功能。
>比如我将一个名为`test.txt`从`/home/XX/`笔记硬链接到`/home/XX/`桌面,
编辑桌面的`test.txt`时 笔记下的`test.txt`已同步更新了
即使不小心把桌面上的`test.txt`删了, `/home/XX/`笔记里的`test.txt`还在
你可能会说为什么不直接复制`test.txt`呢?
复制要占两个大小啊,而且复制了,你编辑了一个,另一个它不同步啊
* 缺点
**软链接**文件包含有原文件的路径信息，所以当原文件从一个目录下移到其他目录中，再访问链接文件，系统就找不到了
**硬链接**就没有这个缺陷，你想怎么移就怎么移

### 4. 怎么创建
* 查看
```
$ ls -l
total 504
-rw-rw-r-- 1 wangdanna wangdanna  91327 10月 11 14:03 github_api.png
-rw-rw-r-- 1 wangdanna wangdanna 413749 10月 12 21:40 html5播放器.png
drwxrwxr-x 2 wangdanna wangdanna   4096 10月  9 17:29 Wallpapers/
```
*   创建软链接
```
 $ ln -s old.file soft.link 
// 可对不存在的文件创建软链接
 $ ls -l 
total 504
-rw-rw-r-- 1 wangdanna wangdanna  91327 10月 11 14:03 github_api.png
-rw-rw-r-- 1 wangdanna wangdanna 413749 10月 12 21:40 html5播放器.png
lrwxrwxrwx 1 wangdanna wangdanna      8 10月 14 16:28 soft.link -> old.file
drwxrwxr-x 2 wangdanna wangdanna   4096 10月  9 17:29 Wallpapers/
```

  ```
 $ cat soft.link 
# 由于被指向的文件不存在，此时的软链接 soft.link 就是死链接
 cat: soft.link: No such file or directory 
```

  ```
$  echo "This is an original file_A" >> old.file 
// 创建被指向的文件 old.file，soft.link 恢复成正常的软链接
```

  ```
$ cat soft.link 
#可看到文件内容了
This is an original file_A
```



### 5. 加深理解


  ```
$ touch f1
#创建一个测试文件f1
```

```
ln f1 f2
#创建f1的一个硬连接文件f2
```
```
ln -s f1 f3
#创建f1的一个软链接文件f3
```
```
$ ls -li
#-i参数显示文件的inode节点信息
total 0
4083871 -rw-rw-r-- 2 wangdanna wangdanna 0 10月 14 16:37 f1
4083871 -rw-rw-r-- 2 wangdanna wangdanna 0 10月 14 16:37 f2
4083907 lrwxrwxrwx 1 wangdanna wangdanna 2 10月 14 16:37 f3 -> f1
```
**从上面的结果中可以看出，硬连接文件 f2 与原文件 f1 的`inode`节点相同，均为4083871，然而软连接文件的`inode`节点不同**
```
$ echo "I am f1 file" >>f1
$ cat f1
I am f1 file
$ cat f2
I am f1 file
$ cat f3
I am f1 file
```
```
$ rm -f f1
$ cat f2
I am f1 file
$ cat f3
No such file or directory
```

**通过上面的测试可以看出：当删除原始文件 f1 后，硬连接 f2 不受影响，但是软链接 f1 文件无效**


##### 得出结论
* 删除软链接 f3 ，对 f1，f2 无影响；
* 删除硬链接 f2，对 f1，f3 也无影响；
* 删除原文件 f1，对硬链接 f2 没有影响，导致符号链接 f3 失效；
* 同时删除原文件 f1，硬链接 f2，整个文件会真正的被删除。

### 6. 特性总结
【硬链接】
* 文件有相同的 inode 及 data block；
* 只能对已存在的文件进行创建；
* 不能交叉文件系统进行硬链接的创建；
* 不能对目录进行创建，只可对文件创建；
* 删除一个硬链接文件并不影响其他有相同 inode 号的文件。
不能对目录创建的原因： 硬连接的话，相当于镜像的方式，你创建一个目录的硬连接之后，操作系统需要把这* 个目录下所有的文件都要做一次硬连接（复制一份过去），这样操作系统在访问这个链接的时候要不断去遍历，大大增加复杂度，而且很容易进入死循环。现在linux没有很好支持这个 所以 不支持。详情见[这里](http://unix.stackexchange.com/questions/22394/why-are-hard-links-to-directories-not-allowed-in-unix-linux)和[这里](http://unix.stackexchange.com/questions/22394/why-are-hard-links-to-directories-not-allowed-in-unix-linux)

【软链接】
* 软链接有自己的文件属性及权限等；
* 可对不存在的文件或目录创建软链接；
* 软链接可交叉文件系统；
* 软链接可对文件或目录创建；
* 创建软链接时，链接计数 i_nlink 不会增加；
* 删除软链接并不影响被指向的文件，但若被指向的原文件被删除，则相关软连接被称为死链接(即 dangling link，若被指向路径文件被重新创建，死链接可恢复为正常的软链接

参考链接[https://www.ibm.com/developerworks/cn/linux/l-cn-hardandsymb-links/](https://www.ibm.com/developerworks/cn/linux/l-cn-hardandsymb-links/)

**我是半生不熟 喜欢照自己的怪念头行事
喜欢一切意外 想把生活过成诗的样子
若哪天有幸相遇 请别诧异 其实我并不是个乖孩子**